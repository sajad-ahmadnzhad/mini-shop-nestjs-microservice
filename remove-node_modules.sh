#!/bin/bash

SERVICES=("auth-service" "gateway" "notification-service" "product-service")

read -p "Delete all node_modules? Y/N: " IS_DELETE_ALL

if [[ -z "$IS_DELETE_ALL" || ! "$IS_DELETE_ALL" =~ ^[yYnN]$ ]]; then
    IS_DELETE_ALL='y'
fi

IS_DELETE_ALL=$(echo "$IS_DELETE_ALL" | tr '[:upper:]' '[:lower:]')


if [ $IS_DELETE_ALL = "y" ]; then
for SERVICE in "${SERVICES[@]}"; do
    echo "Processing for $SERVICE ..."
    if [ ! -d "$SERVICE" ]; then
        echo "$SERVICE not found path"
        exit 1
    else 
        if [ ! -d "$SERVICE/node_modules" ]; then
            echo "node_modules $SERVICE not found" 
        else
        echo "Processing for remove node_modules $SERVICE...."
        rm -rf "$SERVICE/node_modules"
        echo "Node_modules $SERVICE removed success"
        fi
    fi
done
else 
    read -t 10 -p "Please enter directory: " DIR
    if [ ! -d "$DIR" -o ! -d "$DIR/node_modules" ]; then 
        echo "Directory or node_modules not found"
        exit 1
    else 
        echo "Processing for remove node_modules $SERVICE...."
        rm -rf "$DIR/node_modules"
        echo "Node_modules $DIR removed success"
    fi
fi
